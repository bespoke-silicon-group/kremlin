env = Environment(CCFLAGS = '-O3 -std=c++11 -Wno-deprecated')

# default c++ library (libc++) doesn't work on Mac (bug?)
if env['PLATFORM'] == 'darwin':
    env.Append(CCFLAGS = ' -stdlib=libc++')

files = ['debug.cpp', 'kremlin.cpp', 'MemMapAllocator.cpp',
    'ProfileNode.cpp', 'CRegion.cpp', 'ProfileNodeStats.cpp', 
	'ShadowMemory.cpp', 'compression.cpp', 'config.cpp', 'minilzo.cpp', 
    'mpool.cpp', 'MShadowStat.cpp', 'ShadowMemoryCache.cpp',
	'MShadowNullCache.cpp', 'TagVectorCache.cpp', 'TagVectorCacheLine.cpp',
	'Handlers.cpp','TimeTable.cpp', 'LevelTable.cpp'
	]
kremlib_dynamic = env.SharedLibrary('kremlin', files)
files.append('arg.cpp')
kremlib_static = env.Library('kremlin', files)
Return('kremlib_static kremlib_dynamic')
